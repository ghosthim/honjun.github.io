title: 《数据重现》之三文件系统
author: hojun
avatar: /images/favicon.png
authorDesc: 一个好奇的人
categories: 技术
date: 2018-04-25 23:56:43
authorLink:
authorAbout:
tags:
 - 悦读
keywords: 文件系统
description: 到底什么是文件系统？文件系统就是对数据进行存储于管理的方式。
photos:
---
到底什么是文件系统？文件系统就是对数据进行存储于管理的方式。
## **文件系统的基本概念**
文件系统中的一些基本概念和特性
### **1.数据单元**
数据在写入磁盘或从磁盘读取时每次操作的数据量称为数据单元，它的大小在建立文件系统时确定。数据单元在不同的文件系统中有不同的称呼，例如FAT和NTFS文件系统中的“簇”，ExtX中的“块（Block）”等，一个数据单元由若干个连续的扇区组成，大小总是2的整数次幂个扇区。存储数据时，系统以数据单元为单位为其分配存储空间，也就是说，总是为其分配整数个数据单元大小的空间。
### **2.坏数据单元**
坏数据单元也就是包含缺陷扇区的数据单元。许多文件系统可以将一个数据单元标记为坏单元，这对那些没有能力处理错误的老硬盘比较有用。当一个数据单元中出现缺陷扇区时，即使缺陷扇区的数量只有一个，操作系统也会将整个数据单元标记为已损坏，不再分配给文件使用。现在的硬盘可以自己检测到坏扇区的存在并用备用扇区对其进行替换，所以文件系统的这一功能已很少使用。
利用文件系统的坏单元标记功能可以很容易的隐藏数据。
### **3.逻辑文件系统地址**
磁盘上的一个扇区在不同情况下会有不同的地址表达形式。例如：

 - 每个扇区都会有一个LBA地址，也就是物理地址。
 - 每个物理卷内的扇区又有一个物理卷地址。
 - 在逻辑卷内部的扇区会有一个逻辑卷地址。

建立了文件系统后文件系统既使用逻辑卷地址，也使用一种“逻辑文件系统地址”。文件系统存储数据时是以数据单元为存储单位，每个单位被分配一个逻辑文件系统地址。
### **4.逻辑文件地址**
对于每个文件来讲，将它所在的文件系统中数据单元的大小为单位进行分割，分割后的每个部分由0开始进行编号，这个编号就是其对应的数据单元的逻辑文件地址。一个文件前后相邻的两个数据单元在物理上的存储地址可能是不连续的，但它的逻辑文件地址却一定是连续的。
### **5.分配策略**
不同的操作系统在为文件分配存储单元时可能会使用不同的分配方法。通常操作系统会为其分配连续的存储空间，但并不总是能够实现。
为文件分配存储单元是的方法或算法，我们称之为“分配策略”，分配策略通常可以分为三种：第一可用分配策略、下一可用分配策略和最佳分配策略。
**第一可用分配策略**，即当为一个文件分配了一个存储单元后还需要继续为其分配时，操作系统会重新从文件系统的起始处搜索可以使用的空间。这种分配方式很容易使文件片段化，因为文件并不是被作为整体一次性分配连续存储空间的。
例子：假如一个文件需要4个存储单元，文件系统内的1、2、3、5、10号存储单元已有数据，4,、6、7、8、9号存储单元空闲。

 - 1.存储第一部分，从起始处开始找空位，一直找到4号存储单元，存储进去
 - 2.存储第二部分，从起始处开始找空位，一直找到6号存储单元，存储进去
 - 3.存储第三部分，从起始处开始找空位，恰好这时2号存储单元的文件内容被删除了，找到2号位置就找到了空位，存储进去。
 - 4.存储第四部分，从起始处开始找空位，一直找到7号存储单元，存储进去。
所以这个文件的4个部分存储位置就是4-6-2-7。如图所示：
![](https://wx4.sinaimg.cn/large/006bYVyvgy1fqpchyrvfaj30h403b742.jpg)
**下一可用分配策略**，即为文件分配了一个存储单元后并不再回到卷起始处重新寻找可用空间，而是直接向后进行搜索。对于前面的例子，使用下一可用策略进行分配的结果会是4-6-7-8。如图所示：
![](https://wx1.sinaimg.cn/large/006bYVyvgy1fqpci3x3w3j30hl03xa9u.jpg)
**最佳分配策略**，即在为文件分配空间时，会尽可能找到足够的连续空间以避免其片段化。但这种分配策略需要事先知道文件所需要空间的大小，而且如果以后文件增大需要增加分配单元时，新分配的单元有可能处于其他位置而使改文件片段化。对于前面的例子，使用最佳匹配策略分配时，结果则是6-7-8-9

### **6.文件更新策略**
对数据可恢复性进行分析时，除需要考虑它的分配策略外，还需要考虑到文件更新方式的问题：
有的程序对文件更新时，直接打开原文件，更新后，直接用新文件覆盖原文件进行保存。（这种方式原数据无法恢复）
有的程序则是先产生一个原文件的副本，对副本进行更新，然后将副本以原文件名保存在新的位置同时删除原文件。（这种方式可以试图找到旧文件）
### **7.松弛空间**
松弛空间分为两种，一种是数据的结尾与为其分配的空间结束处的未被使用的部分，还有一种是位于分区结尾的卷松弛空间。
### **8.压缩和稀疏文件**
很多文件系统允许对文件进行压缩存储以减少它所占用的数据单元。对于文件，可以存在三种级别的压缩：
 - 最高级别的压缩是在文件内部发生的，例如JPEG格式的文件，它将图像信息进行压缩后保存进文件中，不过文件头是不被压缩的。
 - 次级别的压缩是使用外部程序对整个文件进行压缩后保存成一个新的文件，当需要使用这个文件时，就必须先对其进行解压缩。
 - 最后一种，也是最低级别的压缩，是由操作系统进行的压缩处理。操作系统是在存储文件时，不为连续为0的部分分配存储空间，以这种方式处理过的文件称为“稀疏文件”

### **9.加密文件**
为了数据内容的安全与隐私性，文件可以被加密以阻止未被授权的访问。

10.元数据
任何文件或目录，都会有一个名字，我们将其统称为“文件名”。除文件名外，文件或目录还会有其他一些描述信息，如大小、时间信息、是否加密或压缩、存储位置等，我们将这些描述信息统称为文件或目录的元数据 。